<%- include('partials/_header', { title: 'Debt Ledger', user: user }) %>

<div class="animate-slide-up">
    
    <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4 px-2">
        <div>
            <h1 class="text-4xl font-bold text-white tracking-tight">Debt Ledger</h1>
            <p class="text-gray-500 mt-2">Track outstanding payments.</p>
        </div>
        
        <div class="flex items-center gap-3 w-full md:w-auto">
            <div class="flex-1 md:flex-none bg-[#0a0a0a] px-5 py-3 rounded-2xl border border-[#1f1f1f] text-right">
                <p class="text-gray-500 text-xs uppercase tracking-wider font-bold">Total Pending</p>
                <p class="text-2xl font-bold text-red-400">
                    ₹<%= totalPending.toFixed(2) %>
                </p>
            </div>
            <a href="/debts/add" class="bg-primary hover:bg-indigo-600 text-white p-4 rounded-2xl transition-colors shadow-lg shadow-primary/20 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        
        <% if (debts.length > 0) { %>
            <% debts.forEach(debt => { %>
                <div class="bg-[#0a0a0a] border <%= debt.status === 'Paid' ? 'border-[#1f1f1f] opacity-60' : 'border-red-900/30' %> rounded-3xl p-6 shadow-xl relative group transition-all hover:border-gray-600">
                    
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-xl text-white font-bold"><%= debt.vendorName %></h2>
                            <p class="text-sm text-gray-500 mt-1 font-mono"><%= new Date(debt.createdAt).toLocaleDateString() %></p>
                        </div>
                        <span class="<%= debt.status === 'Paid' ? 'bg-green-500/10 text-green-400 border-green-500/20' : 'bg-red-500/10 text-red-400 border-red-500/20' %> text-[10px] uppercase tracking-widest font-bold px-3 py-1.5 rounded-full border">
                            <%= debt.status %>
                        </span>
                    </div>

                    <p class="text-4xl font-bold text-white mb-5 tracking-tight">
                        ₹<%= debt.amount.toFixed(2) %>
                    </p>

                    <% if (debt.notes) { %>
                        <p class="text-sm text-gray-400 bg-black p-4 rounded-xl mb-5 border border-[#1f1f1f] leading-relaxed">
                            <%= debt.notes %>
                        </p>
                    <% } %>

                    <div class="flex gap-2">
                        <form action="/debts/toggle/<%= debt._id %>" method="POST" class="flex-1">
                            <button type="submit" class="w-full py-3 rounded-xl font-bold text-sm transition-colors <%= debt.status === 'Paid' ? 'bg-[#1f1f1f] text-gray-400 hover:bg-gray-700' : 'bg-white text-black hover:bg-gray-200' %>">
                                <%= debt.status === 'Paid' ? 'Mark Unpaid' : 'Mark Paid' %>
                            </button>
                        </form>

                        <form action="/debts/delete/<%= debt._id %>" method="POST" onsubmit="return confirm('Delete this record?');">
                            <button type="submit" class="p-3 rounded-xl bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white transition-colors border border-red-500/20">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                                </svg>
                            </button>
                        </form>
                    </div>

                </div>
            <% }) %>
        <% } else { %>
            <div class="col-span-full text-center py-24">
                <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-[#0a0a0a] mb-6 border border-[#1f1f1f]">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10 text-gray-600">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                </div>
                <p class="text-gray-500 text-lg">No debts recorded.</p>
            </div>
        <% } %>
        
    </div>
</div>

<%- include('partials/_footer') %>